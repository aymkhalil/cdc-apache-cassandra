plugins {
    id 'java'
    id 'distribution'
    id 'io.github.lhotari.gradle-nar-plugin'
}

configurations {
    release
}

dependencies {
    release project(path: ':agent-c3-luna', configuration: 'shadow')
    release project(path: ':agent-c4-luna', configuration: 'shadow')
    release project(path: ':agent-c3-pulsar', configuration: 'shadow')
    release project(path: ':agent-c4-pulsar', configuration: 'shadow')
    if (project.hasProperty("dse4")) {
        release project(path: ':agent-dse4-luna', configuration: 'shadow')
        release project(path: ':agent-dse4-pulsar', configuration: 'shadow')
    }
    release project(path: ':connector-luna', configuration: 'nar')
    release project(path: ':connector-pulsar', configuration: 'nar')
}

import de.fanero.gradle.plugin.nar.Nar;

distributions {
    main {
        distributionBaseName = 'cassandra-source-connectors'
        contents {
            from('src/main') {
                include '**'
            }
            from configurations.release
            from(project(":connector-luna").tasks.withType(Nar))
            from(project(":connector-pulsar").tasks.withType(Nar))
        }
    }
}
