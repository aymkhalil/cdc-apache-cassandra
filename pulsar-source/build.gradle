plugins {
    id 'java'
    id 'java-library'
    id 'de.fanero.gradle.plugin.nar'
}

tasks.withType(JavaCompile) {
    options.compilerArgs += '-Xlint:none'
}

dependencies {
    implementation "org.projectlombok:lombok:${lombokVersion}"
    annotationProcessor "org.projectlombok:lombok:${lombokVersion}"

    implementation project(':common')

    implementation "com.github.ben-manes.caffeine:caffeine:2.5.5"
    implementation "com.datastax.oss:java-driver-core:${ossDriverVersion}"
    implementation "com.datastax.oss:java-driver-query-builder:${ossDriverVersion}"
    implementation("org.apache.pulsar:pulsar-io-common:${pulsarVersion}")
    implementation("org.apache.pulsar:pulsar-io-core:${pulsarVersion}")
    implementation("com.datastax.oss:messaging-connectors-commons-core:1.0.11")

    testCompile "org.testcontainers:cassandra:1.15.2"
    testCompile "net.andreinc.mockneat:mockneat:0.2.2"
    testCompile "com.google.code.gson:gson:test"
    testCompile "org.testng:testng:7.3.0"
    testCompile "org.mockito:mockito-core:3.0.0"
    testCompile "org.powermock:powermock-api-mockito2:2.0.9"
    testCompile "org.powermock:powermock-module-testng:2.0.9"
    testCompile "org.assertj:assertj-core:3.18.1"

    nar "org.apache.pulsar:pulsar-io:${pulsarVersion}"
}

jar {
    zip64=true
    from {
        configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
    }
}

nar {
    manifest {
        attributes 'Nar-Group': 'org.apache.pulsar'
        attributes 'Nar-Id': 'pulsar-io-cassandra-source-nar'
    }
    from("./src/main/resources") {
        include("META-INF/services/pulsar-io.yaml")
    }
}


